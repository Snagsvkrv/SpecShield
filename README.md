# SpecShield - API Testing Automation Framework

## Overview
SpecShield is an intelligent API testing automation framework built with Spring Boot that automatically generates, executes, and reports on comprehensive test suites derived from Swagger/OpenAPI specifications. The platform leverages asynchronous processing with Kafka messaging and provides real-time test execution monitoring.

## Key Features

### Core Capabilities
- **Automatic Test Generation**: Converts Swagger/OpenAPI contracts into executable test suites
- **Intelligent Test Execution**: Parallel processing with URL-based grouping for optimal performance
- **Real-time Monitoring**: Live updates during test execution with comprehensive reporting
- **Asynchronous Processing**: Kafka-based message queue for scalable test execution
- **MongoDB Integration**: Persistent storage for test results, reports, and execution history

### Advanced Testing Features
- **Multi-HTTP Method Support**: GET, POST, PUT, DELETE, OPTIONS, HEAD
- **Dynamic Parameter Handling**: Path parameters, query parameters, headers, and body payloads
- **JSON Path Assertions**: Sophisticated response validation with configurable assertions
- **Comprehensive Result Tracking**: Success, error, and warning categorization with detailed metrics
- **Historical Test Analytics**: Track test execution trends over time with hash-based unique test identification

## System Architecture

### Core Services
1. **SwaggerParser**: Processes OpenAPI/Swagger specifications
2. **TestSuiteGenerator**: Creates executable test cases from API specifications
3. **TestSuiteService**: Orchestrates test suite generation and execution workflow
4. **ExecutorService**: Manages parallel test execution with real-time result updates
5. **ReportCollector**: Aggregates and formats comprehensive test reports
6. **HistoryService**: Provides historical test analytics and trend tracking

### Data Flow Components
- **SwaggerToApiModelConverter**: Transforms parsed Swagger into internal API models
- **TestSuiteSerializer**: JSON serialization for test suite persistence
- **PayloadGenerator**: Creates dynamic request payloads for test cases

### Storage & Messaging
- **MongoDB Repositories**: TestResultRepository, TestExecutionRequestRepository
- **Kafka Integration**: Asynchronous test execution queue processing
- **Real-time Updates**: Live progress tracking during test execution

## System Design

The complete system architecture and data flow is illustrated in the ![System Architecture](diagrams/SpecShieldArchitecture.drawio.svg). This diagram shows:

1. **Input Processing**: Swagger/OpenAPI contract parsing and API model conversion
2. **Test Generation**: Automated test suite creation with seed data integration
3. **Serialization Flow**: TestSuiteSerializer component for JSON serialization
4. **Execution Pipeline**: Asynchronous processing via Kafka messaging queue
5. **Parallel Processing**: URL-based grouping for optimal test execution performance
6. **Real-time Storage**: MongoDB integration with live result updates
7. **API Layer**: REST endpoints for test generation and report retrieval

> **Note**: To view the system design diagram, open `SpecShield.drawio` in [draw.io](https://app.diagrams.net/) or any compatible diagram viewer.

## API Endpoints

### Execute Test Suite
```
POST /specshield/api/execute
Content-Type: application/json

{
  "testSuiteName": "CustomerService_AutoGenerated",
  "id": "CustomerService_AutoGenerated_1",
  "baseURL": "http://localhost:8080",
  "testCases": [
    {
      "testCaseId": "TC001",
      "testType": "happypath",
      "endpoint": {
        "method": "GET",
        "url": "/customers"
      },
      "request": {
        "headers": {
          "Content-Type": "application/json"
        }
      },
      "expected": {
        "statusCode": 200,
        "assertions": [
          {
            "jsonPath": "$.customers",
            "condition": "NOT_EMPTY"
          }
        ]
      }
    }
  ]
}
```

### Get Report
```
GET /specshield/api/report/{reportId}
```

### Generate Test Suite from Swagger
```
POST /specshield/generate
Content-Type: application/json
tenantId: {your-tenant-id}

{
  "openApiUrl": "https://api.example.com/v3/api-docs",
  "endpoints": {
    "/users": ["GET", "POST"],
    "/users/{id}": ["GET", "PUT", "DELETE"]
  },
  "testConfig": {
    "includeHappyPath": true,
    "includeEdgeCases": true
  }
}
```

## History API Endpoints

The History API provides comprehensive analytics and tracking of test execution trends over time.

### Get All Test History
```
GET /specshield/history/tests?tenantId={tenant}&baseUrl={url}
```
Returns a list of all tests with their execution history, success rates, and recent trends.

### Get Test History by Contract Path
```
GET /specshield/history/tests/contractPath?tenantId={tenant}&baseUrl={url}&contractPath={path}
```
Returns detailed history for tests related to a specific API contract path.

### Get Test Summary Statistics
```
GET /specshield/history/tests/summary?tenantId={tenant}&baseUrl={url}
```
Returns aggregated statistics including:
- Total unique tests
- Total executions
- Overall success rate
- Summary metrics

**Example Response:**
```json
{
  "tenantId": "demo",
  "baseUrl": "https://api.example.com",
  "totalUniqueTests": 25,
  "totalExecutions": 150,
  "totalSuccesses": 142,
  "overallSuccessRate": 94.67,
  "timestamp": "2025-12-05T01:11:53.808987"
}
```

## Parallel Processing
Tests are grouped by base URL and executed in parallel groups for optimal performance:
- Each URL group runs in its own CompletableFuture
- Tests within the same group execute sequentially
- Different URL groups execute concurrently

## Running the Application

### Using Docker Compose
```bash
# Build and start the application with MongoDB and Kafka
docker-compose up --build

# Access the application
curl http://localhost:9000/specshield/api/execute
```

### Local Development
1. Start MongoDB locally on port 27017
2. Start Kafka locally on port 9092
3. Run the Spring Boot application
4. Application will be available at http://localhost:9000

## Configuration
- **Port**: 9000
- **Context Path**: /specshield

## Historical Test Tracking

SpecShield automatically tracks test execution history using a unique hash-based identification system:

### Test Key Generation
Each test is uniquely identified by a hash of:
- Contract Path
- HTTP Method
- Test Type (happypath/negative)
- Request signature (query params/payload pattern)
- Expected response code

### Analytics Features
- **Trend Analysis**: Track success rate changes over time
- **Regression Detection**: Identify tests with declining performance
- **Execution Statistics**: Monitor test frequency and reliability
- **Contract-based Filtering**: View history for specific API endpoints

### Data Storage
All test execution history is stored in MongoDB with the following structure:
- Test execution results with timestamps
- Aggregated success rates and counts
- Recent execution trends (last 5-10 runs)
- Contract path and method metadata
